## 问题诊断
- 采样画布固定为 `512×512`，根据适配模式缩放：`src/components/ParticleScene.tsx:211-216`。选择 `cover` 会裁剪边缘；`contain` 保持比例但会留空。
- 世界坐标映射始终到正方形区域（50×50），图像只占其中一部分：`src/components/ParticleScene.tsx:254-256`。
- 颜色不全源于亮度阈值筛选与伽马增强：
  - 亮度直方图与动态阈值：`src/components/ParticleScene.tsx:221-241`。
  - 颜色通道也应用了伽马：`src/components/ParticleScene.tsx:249-261`，导致与原图有偏差。
- 设置传递缺口：`App.tsx` 已把 `imageFit/imageColorFidelity/imageThresholdQuantile/imageGamma` 传给 `ParticleScene`（`src/App.tsx:173-176`），但 `ParticleScene` 未再传入 `Particles`，导致 UI 设置对采样与材质不生效：`src/components/ParticleScene.tsx:692-709`。

## 改进方案
1. 将 `imageFit/imageColorFidelity/imageThresholdQuantile/imageGamma` 从 `ParticleScene` 透传给 `Particles`，确保上传面板的设置生效：`src/components/ParticleScene.tsx:692-709`。
2. 采样颜色保真：当 `imageColorFidelity=true` 时，颜色通道使用原始 `r/255,g/255,b/255`，仅对亮度统计使用伽马；避免颜色被二次增强：`src/components/ParticleScene.tsx:249-261`、`221-241`。
3. 纵横比呈现优化：保留 `contain/cover` 行为，但将坐标映射按图像有效区域的宽高做等比缩放，减少在正方形世界坐标中的“留边”或视觉压缩：`src/components/ParticleScene.tsx:254-256`。
4. 渲染器色彩空间：在 `<Canvas>` 显式设置 `outputColorSpace=sRGB`，与顶点颜色保持一致，减少显示偏差：`src/components/ParticleScene.tsx:689`。
5. 交互建议：
  - 选择“适配模式：保持比例居中”（`UploadPanel.tsx:87-93`）。
  - 开启“颜色保真”（`UploadPanel.tsx:96-101`）。
  - 将“采样阈值”滑到较低（如 0.25），涵盖更多暗部颜色（`UploadPanel.tsx:106-108`）。
  - 将“亮度增强”调近 `1.0`，减少色偏（`UploadPanel.tsx:112-114`）。

## 预期效果
- 图片按上传比例完整呈现，无非期望裁剪；在正方形空间中尽量减少留边失真。
- 颜色更接近原图，暗部不再大量丢失；材质在图像模式下使用 `NormalBlending` 保留原色：`src/components/ParticleScene.tsx:657`。

## 下一步
- 我将按以上方案修改并验证，包括：透传参数、采样逻辑调整、Canvas 色彩空间设置、交互测试与截图对比。请确认后执行。