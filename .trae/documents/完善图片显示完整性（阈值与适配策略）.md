## 现状与原因
- 已按比例绘制：主线程与 Worker 都改为等比缩放居中（contain），不会被拉伸。
- 仍可能“不全”的主要原因：
  - 采样阈值过高导致暗部/半透明像素被忽略（`src/components/ParticleScene.tsx:215-223`、`src/workers/imageSampler.ts:19-26,32-41`）；当前 `alpha > 80`，亮度阈值取平均亮度的 45%，对暗图不友好。
  - 无“填满”策略：contain 会保留上下/左右留白，用户视觉上可能认为“没铺满”，需要可选 cover 策略（等比填满并居中裁剪）。

## 改动目标
- 让图片在点云中更完整：暗部、半透明边缘也能显示。
- 提供显示策略切换：`contain` 与 `cover`，满足“保持比例”与“铺满区域”的两种需求。
- 当采样过少时自动放宽阈值，避免出现残缺形状。

## 具体修改
1. 阈值策略优化（两处一致：主线程与 Worker）
   - 将 `alpha` 下限从 `80` 降到 `20`，兼容半透明边缘。
   - 亮度阈值由均值 * 0.45 改为分位数阈值（如 60% 分位），更稳健；并设置最小值，例如 `minBright = 20`。
   - 若采样点数 < N（如 1500），逐步降低阈值直至达到下限或采样充足。
   - 代码位置：
     - 主线程：`ParticleScene.tsx:197-209, 212-229` 的亮度统计与阈值判断
     - Worker：`imageSampler.ts:18-26, 32-41` 的亮度统计与阈值判断
2. 适配策略切换（contain/cover）
   - 增加 `imageFit: 'contain'|'cover'` 配置，从 `App.tsx` 传入到 `ParticleScene` 与 Worker。
   - 绘制时：
     - contain：当前逻辑（`s = min(...)`，居中留白）。
     - cover：`s = max(...)`，居中裁剪超出部分（仍保持比例但填满画布）。
   - 代码位置：
     - 主线程绘制：`ParticleScene.tsx:193-201` 增加分支
     - Worker 绘制：`imageSampler.ts:13-16` 增加分支
3. 采样健壮性
   - 若最终 `pts.length === 0`，回退到更低阈值重试一次；仍为空则提示并回退随机云。
   - 位置：主线程与 Worker 采样结束处。

## 验证
- 用暗色横图、半透明 PNG、超宽/超高图片测试：
  - contain 模式：完整显示，居中留白，暗部不再缺失。
  - cover 模式：填满区域，边缘被对称裁剪但形状完整。
- 观察点数与性能，确保不会明显卡顿；效果模式与后期保持不变。

## 预计改动范围
- 修改 `src/components/ParticleScene.tsx` 与 `src/workers/imageSampler.ts` 的绘制与采样阈值逻辑。
- 在 `App.tsx` 及 `UploadPanel.tsx` 增加可选项传递 `imageFit`（默认 `contain`）。